<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dazoru Projects v12.3</title>
    
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="apple-touch-icon" href="logo.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1A2935">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root {
            --bg-dark: #1A2935;
            --card-bg: #243447;
            --input-bg: #3A4B5F;
            --gold: #D4AF37;
            --white: #FFFFFF;
            --silver: #B0BCC7;
        }

        body { font-family: 'Poppins', sans-serif; background: var(--bg-dark); color: var(--white); margin: 0; padding: 10px; overflow-x: hidden; }

        .container {
            max-width: 500px; margin: 0 auto; background-color: var(--card-bg);
            border-radius: 20px; padding: 20px; position: relative; 
            border: 1px solid rgba(255, 255, 255, 0.05); box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .settings-btn { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 24px; cursor: pointer; z-index: 100; }

        h1 { color: var(--gold); text-align: center; font-size: 20px; margin: 5px 0; text-transform: uppercase; letter-spacing: 1px; }
        .subtitle { text-align: center; color: var(--silver); font-size: 11px; margin-bottom: 20px; }

        /* PANEL CONFIGURACI√ìN */
        #configPanel { 
            background: rgba(15, 23, 32, 0.98); padding: 25px; border-radius: 15px; 
            margin-bottom: 20px; border: 1px solid var(--gold); display: none; 
            position: absolute; width: 88%; left: 6%; top: 55px; z-index: 200;
            box-shadow: 0 0 50px rgba(0,0,0,0.9);
        }

        .config-title { color: var(--gold); font-size: 13px; font-weight: bold; margin-bottom: 12px; border-bottom: 1px solid #444; padding-bottom: 5px; }
        label { display: block; font-size: 11px; color: var(--silver); margin-bottom: 5px; margin-top: 10px; }

        input, select {
            width: 100%; background: var(--input-bg); border: 1px solid transparent; color: white;
            padding: 12px; border-radius: 10px; font-size: 14px; box-sizing: border-box; outline: none;
        }

        .row { display: flex; gap: 10px; margin-bottom: 12px; }
        .col { flex: 1; }

        /* CHIPS */
        .chip-group { display: flex; gap: 8px; background: var(--input-bg); padding: 5px; border-radius: 10px; margin-bottom: 15px; }
        .chip-input { display: none; }
        .chip-label { flex: 1; text-align: center; padding: 10px; border-radius: 8px; font-size: 11px; cursor: pointer; color: var(--silver); }
        .chip-input:checked + .chip-label { background: var(--gold); color: #1A2935; font-weight: bold; }

        .result-box { background: rgba(0,0,0,0.3); border: 1px solid var(--gold); border-radius: 15px; padding: 20px; text-align: center; margin-top: 20px; }
        .total-price { font-size: 40px; color: var(--gold); font-weight: bold; margin: 0; }

        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-size: 15px; font-weight: bold; cursor: pointer; margin-top: 12px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-gold { background: var(--gold); color: #1A2935; }
        .btn-green { background: #27ae60; color: white; }
        .btn-outline { background: transparent; border: 1px solid var(--silver); color: var(--silver); }

        /* FIRMA PAUL GC */
        .footer-credits {
            text-align: center; font-size: 9px; color: rgba(255,255,255,0.25);
            margin-top: 25px; letter-spacing: 1.5px; text-transform: uppercase;
        }

        /* BOLETA */
        #boletaContainer { display: none; }
        #boletaView { background: white; color: black; padding: 40px 30px; position: relative; min-height: 520px; box-sizing: border-box; }
        .watermark { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            width: 320px; height: 320px; background-size: contain; background-repeat: no-repeat; 
            background-position: center; z-index: 0; pointer-events: none;
        }
        .boleta-header { display: flex; justify-content: space-between; align-items: center; z-index: 10; position: relative; margin-bottom: 30px; }
        .logo-box { width: 85px; height: 85px; border-radius: 50%; overflow: hidden; border: 2px solid var(--gold); background: white; }
        .logo-box img { width: 100%; height: 100%; object-fit: contain; }
        
        table { width: 100%; border-collapse: collapse; margin: 25px 0; z-index: 10; position: relative; font-size: 12px; }
        th { border-bottom: 2px solid #333; padding: 12px 8px; text-align: left; }
        td { padding: 12px 8px; border-bottom: 1px solid #eee; }
        .total-row { font-weight: bold; font-size: 18px; border-top: 2px solid #333; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="container" id="calcView">
    <button class="settings-btn" onclick="toggleConfig()">‚öôÔ∏è</button>
    <h1>Dazoru Projects</h1>
    <p class="subtitle">el arte de transformar espacios | v12.3</p>

    <div id="configPanel">
        <div class="config-title">üñºÔ∏è DISE√ëO DE BOLETA</div>
        <label>Cargar Logo (.png / .jpg):</label>
        <input type="file" id="logoInput" accept="image/*" onchange="handleLogo(event)">
        <label>Transparencia de Logo:</label>
        <input type="range" id="opacidadInput" min="0" max="0.4" step="0.05" value="0.1" oninput="updateOpacity(this.value)">
        
        <div class="config-title" style="margin-top:20px;">üè¢ DATOS DEL NEGOCIO</div>
        <input type="text" id="confNombre" placeholder="Dazoru Projects" oninput="saveConf()">
        <input type="text" id="confTelf" placeholder="930 132 709 / 958 786 703" oninput="saveConf()">
        <button class="btn btn-gold" onclick="toggleConfig()">Guardar y Cerrar</button>
    </div>

    <div class="row">
        <input type="text" id="cliente" placeholder="Nombre Cliente" class="col">
        <input type="text" id="celular" placeholder="WhatsApp" class="col">
    </div>

    <div class="chip-group">
        <input type="radio" name="forma" id="rect" value="rect" class="chip-input" checked onchange="calc()">
        <label for="rect" class="chip-label">Cuadrado/Rect</label>
        <input type="radio" name="forma" id="circ" value="circ" class="chip-input" onchange="calc()">
        <label for="circ" class="chip-label">Circular</label>
    </div>

    <div class="row">
        <div class="col"><label>Ancho (cm)</label><input type="number" id="ancho" placeholder="0" oninput="calc()"></div>
        <div class="col" id="colAlto"><label>Alto (cm)</label><input type="number" id="alto" placeholder="0" oninput="calc()"></div>
    </div>

    <label>Material:</label>
    <select id="material" onchange="calc()">
        <option value="3mm_marco">Espejo de 3 mm con Marco</option>
        <option value="3mm">Espejo de 3 mm (Solo Vidrio)</option>
        <option value="4mm">Espejo de 4 mm</option>
        <option value="opti">Espejo 4 mm Optimirror</option>
    </select>

    <div id="finishGroup">
        <label>Acabado:</label>
        <div class="chip-group">
            <input type="radio" name="acabado" id="pul" value="pul" class="chip-input" checked onchange="calc()">
            <label for="pul" class="chip-label">Pulido ‚ú®</label>
            <input type="radio" name="acabado" id="bis1" value="bis1" class="chip-input" onchange="calc()">
            <label for="bis1" class="chip-label">Bisel 1cm</label>
            <input type="radio" name="acabado" id="bis2" value="bis2" class="chip-input" onchange="calc()">
            <label for="bis2" class="chip-label">Bisel 2cm</label>
        </div>
    </div>

    <div class="row">
        <div class="col">
            <label>Arenado:</label>
            <select id="arenado" onchange="calc()">
                <option value="no">Sin Arenado</option>
                <option value="si">Con Arenado</option>
            </select>
        </div>
        <div class="col">
            <label>LED:</label>
            <select id="led" onchange="calc()">
                <option value="no">Sin Luz</option>
                <option value="1">1 Tono</option>
                <option value="3">3 Tonos</option>
            </select>
        </div>
    </div>

    <div class="row" style="background: rgba(212,175,55,0.08); padding: 12px; border-radius: 12px; align-items: center;">
        <input type="checkbox" id="seguridad" onchange="calc()" style="width:18px; margin-right:10px;">
        <label style="margin:0; color:white; font-size:12px;">L√°mina de Seguridad (+S/ 25 m¬≤)</label>
    </div>

    <div class="result-box">
        <div class="total-price" id="totalDisp">S/ 0.00</div>
    </div>

    <button class="btn btn-gold" onclick="showBoleta()">Generar Cotizaci√≥n üìÑ</button>
    <button class="btn btn-outline" onclick="location.reload()">Nuevo üîÑ</button>

    <div class="footer-credits">
        ¬© 2026 | Systems & Optimization by <b>Paul GC</b>
    </div>
</div>

<div class="container" id="boletaContainer">
    <div id="boletaView">
        <div class="watermark" id="bolWatermark"></div>
        <div class="boleta-header">
            <div class="logo-box"><img id="bolLogo" src="logo.png"></div>
            <div style="text-align:right;">
                <h2 style="margin:0; color:var(--gold); font-size:22px;">COTIZACI√ìN</h2>
                <b id="resEmpresa">Dazoru Projects</b><br>
                <span id="resTelf" style="font-size:11px;"></span>
            </div>
        </div>
        
        <p style="font-size:12px; border-bottom:1px solid #eee; padding-bottom:12px;">
            <b>Cliente:</b> <span id="resCliente"></span><br>
            <b>Fecha:</b> <span id="resFecha"></span>
        </p>

        <table>
            <thead><tr><th>Descripci√≥n</th><th style="text-align:right">Total</th></tr></thead>
            <tbody id="tablaItems"></tbody>
            <tfoot><tr class="total-row"><td>TOTAL</td><td style="text-align:right" id="resTotal"></td></tr></tfoot>
        </table>
        <p style="text-align:center; font-size:11px; color:#666; font-style:italic;">"el arte de transformar espacios"</p>
    </div>
    <button class="btn btn-green" onclick="enviarWhatsApp()">Enviar WhatsApp üí¨</button>
    <button class="btn btn-gold" onclick="window.print()">Imprimir PDF üì•</button>
    <button class="btn btn-outline" onclick="location.reload()">Volver üîÑ</button>
    
    <div class="footer-credits" style="color:#aaa;">
        ¬© 2026 | Systems & Optimization by <b>Paul GC</b>
    </div>
</div>

<script>
    window.onload = () => {
        document.getElementById('confNombre').value = localStorage.getItem('d_nom') || "Dazoru Projects";
        document.getElementById('confTelf').value = localStorage.getItem('d_tel') || "930 132 709 / 958 786 703";
        const savedLogo = localStorage.getItem('d_logo');
        if(savedLogo) {
            document.getElementById('bolLogo').src = savedLogo;
            document.getElementById('bolWatermark').style.backgroundImage = `url(${savedLogo})`;
        }
        updateOpacity(localStorage.getItem('d_op') || 0.1);
    };

    function saveConf() {
        localStorage.setItem('d_nom', document.getElementById('confNombre').value);
        localStorage.setItem('d_tel', document.getElementById('confTelf').value);
    }

    function handleLogo(e) {
        const reader = new FileReader();
        reader.onload = () => {
            const base64 = reader.result;
            localStorage.setItem('d_logo', base64);
            document.getElementById('bolLogo').src = base64;
            document.getElementById('bolWatermark').style.backgroundImage = `url(${base64})`;
        };
        reader.readAsDataURL(e.target.files[0]);
    }

    function updateOpacity(val) {
        document.getElementById('bolWatermark').style.opacity = val;
        localStorage.setItem('d_op', val);
        document.getElementById('opacidadInput').value = val;
    }

    function toggleConfig() {
        const p = document.getElementById('configPanel');
        p.style.display = p.style.display === 'block' ? 'none' : 'block';
    }

    function calc() {
        const mat = document.getElementById('material').value;
        const forma = document.querySelector('input[name="forma"]:checked').value;
        const ancho = parseFloat(document.getElementById('ancho').value) || 0;
        let alto = (forma === 'circ') ? ancho : (parseFloat(document.getElementById('alto').value) || 0);
        
        document.getElementById('colAlto').style.visibility = (forma === 'circ') ? 'hidden' : 'visible';
        document.getElementById('finishGroup').style.display = (mat === '3mm_marco') ? 'none' : 'block';

        if(ancho === 0 || alto === 0) return 0;

        let area = (ancho * alto) / 10000;
        let perimetro = (forma === 'rect') ? (ancho * 2 + alto * 2) / 100 : (Math.PI * ancho) / 100;
        let precio = 0;

        // PRECIOS EST√ÅNDAR
        if(mat === '3mm_marco' && ancho <= 50 && alto <= 50 && forma === 'rect') {
            const tabla = {30:25, 35:28, 40:30, 45:33, 50:35};
            precio = tabla[Math.max(ancho, alto)] || 35;
        } 
        else if (mat === '4mm' && ancho === 50 && alto === 50 && forma === 'rect') {
            precio = 40;
        }
        else if (mat === 'opti' && ancho === 50 && alto === 50 && forma === 'rect') {
            precio = 82;
        }
        // ESCALADO
        else {
            let m2 = 120;
            if(mat.includes('3mm')) m2 = 100;
            if(mat === 'opti') m2 = 288;
            if(forma === 'circ') m2 *= 1.30;

            precio = area * m2;

            if(mat === '3mm_marco') {
                precio += (perimetro * 10);
            } else {
                const aca = document.querySelector('input[name="acabado"]:checked').value;
                if(aca === 'pul') precio += (perimetro * 5);
                if(aca === 'bis1') precio += Math.max(25, perimetro * 12.5);
                if(aca === 'bis2') precio += Math.max(45, perimetro * 22.5);
            }
        }

        if(document.getElementById('arenado').value === 'si') precio += Math.max(55, area * 140);
        const l = document.getElementById('led').value;
        if(l !== 'no') precio += (l === '1' ? 170 : 240);
        if(document.getElementById('seguridad').checked) precio += (area * 25);

        precio = Math.ceil(precio / 5) * 5;
        document.getElementById('totalDisp').innerText = `S/ ${precio.toFixed(2)}`;
        return precio;
    }

    function showBoleta() {
        const p = calc();
        if(!p) return alert("Ingresa medidas");
        document.getElementById('resEmpresa').innerText = localStorage.getItem('d_nom');
        document.getElementById('resTelf').innerText = localStorage.getItem('d_tel');
        document.getElementById('resCliente').innerText = document.getElementById('cliente').value || "Cliente General";
        document.getElementById('resFecha').innerText = new Date().toLocaleDateString();
        let desc = document.getElementById('material').options[document.getElementById('material').selectedIndex].text.toUpperCase();
        desc += ` (${document.getElementById('ancho').value}x${document.getElementById('alto').value}cm)`;
        document.getElementById('tablaItems').innerHTML = `<tr><td>${desc}</td><td style="text-align:right">S/ ${p.toFixed(2)}</td></tr>`;
        document.getElementById('resTotal').innerText = `S/ ${p.toFixed(2)}`;
        document.getElementById('calcView').classList.add('hidden');
        document.getElementById('boletaContainer').style.display = 'block';
    }

    function enviarWhatsApp() {
        const p = calc();
        const msg = `*DAZORU PROJECTS*%0A_Cotizaci√≥n de Espejo_%0A--------------------------%0A*Medida:* ${document.getElementById('ancho').value}x${document.getElementById('alto').value}cm%0A*Total:* S/ ${p.toFixed(2)}%0A--------------------------%0A_Powered by Paul GC_`;
        const tel = document.getElementById('celular').value;
        window.open(`https://wa.me/51${tel}?text=${msg}`, '_blank');
    }
</script>
</body>
</html>
