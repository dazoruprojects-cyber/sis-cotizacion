<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dazoru Projects v13.9</title>
    
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="apple-touch-icon" href="logo.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1A2935">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&family=Great+Vibes&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root { --bg-dark: #1A2935; --card-bg: #243447; --input-bg: #3A4B5F; --gold: #D4AF37; --white: #FFFFFF; --silver: #B0BCC7; }

        body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, var(--bg-dark) 0%, #0f1720 100%); color: var(--white); margin: 0; padding: 10px; min-height: 100vh; overflow-x: hidden; }

        @media print {
            body * { visibility: hidden; }
            #boletaView, #boletaView * { visibility: visible; }
            #boletaView { position: absolute; left: 0; top: 0; width: 100%; margin: 0; padding: 0; border: none; }
            .container { display: none; }
        }

        .container { max-width: 500px; margin: 0 auto; background-color: var(--card-bg); border-radius: 20px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid rgba(255, 255, 255, 0.05); position: relative; }

        .settings-btn { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 24px; cursor: pointer; z-index: 100; }
        h1 { color: var(--gold); text-align: center; font-size: 20px; margin: 5px 0; text-transform: uppercase; letter-spacing: 1px; }
        .subtitle { text-align: center; color: var(--silver); font-size: 11px; margin-bottom: 20px; }

        #configPanel { background: rgba(15, 23, 32, 0.95); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px dashed var(--gold); display: none; position: absolute; width: 88%; left: 6%; top: 55px; z-index: 200; box-shadow: 0 10px 50px rgba(0,0,0,0.8); }
        .config-title { color: var(--gold); font-weight: bold; font-size: 13px; text-transform: uppercase; border-bottom: 1px solid #555; margin-bottom: 10px; }
        
        input, select { width: 100%; background: var(--input-bg); border: 1px solid transparent; color: white; padding: 12px; border-radius: 10px; font-size: 14px; box-sizing: border-box; outline: none; margin-bottom: 8px; }
        input:focus { border-color: var(--gold); }
        label { font-size: 11px; color: var(--silver); display: block; margin-bottom: 5px; margin-top: 5px; }

        .row { display: flex; gap: 10px; margin-bottom: 5px; }
        .col { flex: 1; }

        .chip-group { display: flex; gap: 8px; background: var(--input-bg); padding: 5px; border-radius: 10px; margin-bottom: 15px; }
        .chip-input { display: none; }
        .chip-label { flex: 1; text-align: center; padding: 10px; border-radius: 8px; font-size: 11px; cursor: pointer; color: var(--silver); transition: 0.3s; }
        .chip-input:checked + .chip-label { background: var(--gold); color: #1A2935; font-weight: bold; }

        .result-box { background: rgba(0,0,0,0.3); border: 1px solid var(--gold); border-radius: 15px; padding: 15px; text-align: center; margin-top: 20px; }
        .total-price { font-size: 38px; color: var(--gold); font-weight: bold; margin: 0; }

        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-size: 15px; font-weight: bold; cursor: pointer; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-gold { background: var(--gold); color: #1A2935; }
        .btn-blue { background: #3498db; color: white; }
        .btn-green { background: #27ae60; color: white; } 
        .btn-outline { background: transparent; border: 1px solid var(--silver); color: var(--silver); }

        #boletaContainer { display: none; }
        #boletaView { background: white; color: black; padding: 40px 30px; position: relative; min-height: 600px; box-sizing: border-box; }
        
        /* ESTILO PARA EL NOMBRE DE LA EMPRESA (Tipo Script) */
        #resEmpresa {
            font-family: 'Great Vibes', cursive; /* Fuente Script */
            color: var(--gold);
            font-size: 32px !important; /* Tama√±o grande */
            font-weight: normal; 
            line-height: 1.1;
            display: block;
            margin-top: 15px; /* <--- AJUSTE: Empuja el nombre hacia abajo */
            margin-bottom: 5px;
            text-shadow: 0px 0px 1px rgba(0,0,0,0.1);
        }

        /* --- AJUSTES CELULAR v13.9 --- */
        @media only screen and (max-width: 480px) {
            #boletaView { padding: 15px 12px; } 
            
            .boleta-header { 
                margin-top: 25px; 
                margin-bottom: 10px; 
                align-items: center; 
            }
            
            .boleta-top-code { 
                font-size: 10px !important; 
                top: 10px !important; 
                right: 15px !important; 
            }

            .logo-box { width: 55px !important; height: 55px !important; flex-shrink: 0; margin-right: 8px; }
            
            /* Nombre Script en Celular con margen superior */
            #resEmpresa { font-size: 28px !important; margin-top: 10px !important; margin-bottom: 2px; }

            .bol-info { font-size: 10.5px !important; line-height: 1.25 !important; width: 100%; }
            .bol-info h2 { font-size: 16px !important; margin-bottom: 0px !important; }
            
            .client-section { font-size: 10px !important; margin-bottom: 10px !important; }
            .client-section h3 { font-size: 10px !important; border-bottom: 1px solid #ccc; margin-bottom: 4px; }
            .install-banner { font-size: 10px !important; padding: 6px !important; margin: 10px 0 !important; }
            
            table { font-size: 10px !important; margin: 10px 0 !important; }
            th, td { padding: 5px 3px !important; }
            
            .summary-section { width: 75% !important; font-size: 10px !important; }
            .summary-total { font-size: 14px !important; padding-top: 5px !important; }
            
            .terms { font-size: 8px !important; padding-top: 15px !important; line-height: 1.2; }
        }

        .watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 300px; height: 300px; background-size: contain; background-repeat: no-repeat; background-position: center; z-index: 0; pointer-events: none; opacity: 0.1; }
        .boleta-top-code { position: absolute; top: 20px; right: 30px; font-size: 12px; font-weight: bold; }
        
        .boleta-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 25px; position: relative; z-index: 10; }
        .logo-box { width: 85px; height: 85px; border-radius: 50%; border: 2px solid var(--gold); overflow: hidden; background: white; display: flex; align-items: center; justify-content: center; }
        .logo-box img { width: 100%; height: 100%; object-fit: contain; }
        
        .bol-info { text-align: right; }
        .bol-info h2 { margin: 0 0 5px 0; font-size: 22px; color: #333; font-weight: bold; }
        .bol-info p { margin: 2px 0; font-size: 11px; color: #555; }

        .client-section { margin-bottom: 15px; font-size: 12px; position: relative; z-index: 10; line-height: 1.5; }
        .client-section h3 { font-size: 12px; border-bottom: 1px solid #ccc; display: inline-block; text-transform: uppercase; margin-bottom: 5px; font-weight: bold; }
        
        .install-banner { background: #fffde7; border-left: 5px solid var(--gold); padding: 10px; margin: 15px 0; font-size: 12px; font-weight: bold; position: relative; z-index: 10; display: none; color: #8a6d3b; }

        table { width: 100%; border-collapse: collapse; font-size: 11px; margin: 20px 0; position: relative; z-index: 10; }
        th { border-top: 1px solid #000; border-bottom: 1px solid #000; padding: 8px; text-align: left; }
        td { padding: 8px; border-bottom: 1px solid #eee; }
        .text-right { text-align: right; }
        .text-center { text-align: center; }

        .summary-section { margin-left: auto; width: 60%; font-size: 12px; position: relative; z-index: 10; }
        .summary-row { display: flex; justify-content: space-between; padding: 3px 0; }
        .summary-total { font-weight: bold; font-size: 16px; border-top: 2px solid #000; padding-top: 8px; margin-top: 5px; }

        .terms { clear: both; padding-top: 30px; font-size: 9px; color: #666; text-align: justify; position: relative; z-index: 10; border-top: 1px dashed #ccc; margin-top: 20px; }
        .footer-credits { text-align: center; font-size: 9px; color: rgba(255,255,255,0.25); margin-top: 25px; letter-spacing: 1.5px; text-transform: uppercase; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="container" id="calcView">
    <button class="settings-btn" onclick="toggleConfig()">‚öôÔ∏è</button>
    <h1>Dazoru Projects</h1>
    <p class="subtitle">Sistema Universal v13.9</p>

    <div id="configPanel">
        <div class="config-title">üè¢ DATOS DE EMPRESA</div>
        <input type="text" id="configEmpresa" placeholder="Nombre Negocio" oninput="saveConf()">
        <input type="text" id="configCelulares" placeholder="Celulares (Separa con /)" oninput="saveConf()">
        <input type="text" id="configEmail" placeholder="Correo Electr√≥nico" oninput="saveConf()">
        
        <div class="config-title" style="margin-top:15px">üé® LOGO Y MARCA DE AGUA</div>
        <input type="file" id="logoInput" accept="image/*" onchange="handleLogo(event)">
        <label>Opacidad Marca de Agua:</label>
        <input type="range" id="opacityRange" min="0" max="0.5" step="0.05" value="0.1" oninput="updateOpacity(this.value)">
        <button class="btn btn-gold" onclick="toggleConfig()">Guardar y Cerrar</button>
    </div>

    <div class="row">
        <input type="text" id="cliente" placeholder="üë§ Nombre Cliente" class="col">
        <input type="text" id="telCliente" placeholder="üì± Celular" class="col">
    </div>
    <input type="text" id="dirCliente" placeholder="üìç Direcci√≥n de Instalaci√≥n" style="width:100%;">

    <div class="row" style="margin-top:10px;">
        <div class="col"><label>üìÖ Instalaci√≥n</label><input type="date" id="fechaInstalManual" oninput="calc()"></div>
        <div class="col"><label>‚è∞ Hora</label><input type="time" id="horaInstalManual" oninput="calc()"></div>
    </div>

    <div class="chip-group">
        <input type="radio" name="forma" id="rect" value="rect" class="chip-input" checked onchange="calc()">
        <label for="rect" class="chip-label">‚¨ú Rectangular</label>
        <input type="radio" name="forma" id="circ" value="circ" class="chip-input" onchange="calc()">
        <label for="circ" class="chip-label">‚ö™ Circular</label>
    </div>

    <div class="row">
        <div class="col"><input type="number" id="ancho" placeholder="Ancho (cm)" oninput="calc()"></div>
        <div class="col" id="colAlto"><input type="number" id="alto" placeholder="Alto (cm)" oninput="calc()"></div>
        <div class="col" style="flex:0.5;"><input type="number" id="cantidad" value="1" placeholder="Cant." oninput="calc()" style="text-align:center;"></div>
    </div>

    <label>üíé Material:</label>
    <select id="material" onchange="calc()">
        <option value="3mm_marco">Espejo de 3 mm con Marco</option>
        <option value="3mm">Espejo de 3 mm</option>
        <option value="4mm">Espejo de 4 mm</option>
        <option value="opti">Espejo 4 mm Optimirror</option>
    </select>

    <div id="finishGroup">
        <label>‚ú® Acabado de Bordes:</label>
        <div class="chip-group">
            <input type="radio" name="acabado" id="pul" value="pul" class="chip-input" checked onchange="calc()">
            <label for="pul" class="chip-label">Pulido</label>
            <input type="radio" name="acabado" id="bis1" value="bis1" class="chip-input" onchange="calc()">
            <label for="bis1" class="chip-label">Bisel 1cm</label>
            <input type="radio" name="acabado" id="bis2" value="bis2" class="chip-input" onchange="calc()">
            <label for="bis2" class="chip-label">Bisel 2cm</label>
        </div>
    </div>

    <div class="row">
        <div class="col"><label>Arenado</label><select id="arenado" onchange="calc()"><option value="no">No</option><option value="si">S√≠</option></select></div>
        <div class="col"><label>Sistema LED</label><select id="led" onchange="calc()"><option value="no">No</option><option value="1">1 Tono</option><option value="3">3 Tonos</option></select></div>
    </div>

    <div class="row" style="background: rgba(212,175,55,0.08); padding: 8px; border-radius: 10px; align-items: center; margin-top: 10px;">
        <input type="checkbox" id="segCheck" onchange="calc()" style="width:20px; height:20px; margin-right:10px;">
        <label style="margin:0; color:white; font-size:12px;">L√°mina de Seguridad (+S/ 25 m¬≤)</label>
    </div>

    <div class="row" style="margin-top:10px;">
        <div class="col"><label>üöö Env√≠o</label><input type="number" id="envio" value="0" oninput="calc()"></div>
        <div class="col"><label>üõ†Ô∏è Instalaci√≥n</label><input type="number" id="instal" value="0" oninput="calc()"></div>
        <div class="col"><label>üéÅ Descuento</label><input type="number" id="descuento" value="0" oninput="calc()"></div>
    </div>

    <div class="result-box">
        <div style="font-size:10px; color:var(--silver); letter-spacing:1px; margin-bottom:5px;">TOTAL A COBRAR</div>
        <div class="total-price" id="totalDisp">S/ 0.00</div>
    </div>

    <button class="btn btn-gold" onclick="generarBoleta()">Generar Boleta üìÑ</button>
    <button class="btn btn-outline" onclick="location.reload()">Limpiar Formulario üîÑ</button>
    <div class="footer-credits">¬© 2026 | Systems & Optimization by <b>Paul GC</b></div>
</div>

<div class="container" id="boletaContainer">
    <button class="btn btn-outline" onclick="volver()" style="margin-bottom:15px; color: #333; border-color: #ccc;">‚¨ÖÔ∏è Editar Datos</button>

    <div id="boletaView">
        <div class="watermark" id="bolWatermark"></div>
        <div class="boleta-top-code" id="bolCodigo">B001-000000</div>

        <div class="boleta-header">
            <div class="logo-box"><img id="bolLogo" src="logo.png" onerror="this.style.display='none'"></div>
            <div class="bol-info">
                <h2>Boleta de Venta</h2>
                <strong id="resEmpresa">Dazoru Projects</strong><br>
                Lima, Per√∫<br>
                Cel: <span id="resTelf"></span><br>
                Correo: <span id="resEmail"></span>
            </div>
        </div>
        
        <div class="client-section">
            <h3>Detalles del Cliente:</h3>
            <p><strong>Nombre:</strong> <span id="resCliente"></span></p>
            <p><strong>Tel√©fono:</strong> <span id="resCel"></span></p>
            <p><strong>Direcci√≥n:</strong> <span id="resDir"></span></p>
            <p><strong>Fecha Emisi√≥n:</strong> <span id="resFecha"></span></p>
        </div>

        <div class="install-banner" id="bannerInstal">
            üìÖ INSTALACI√ìN: <span id="resFechaInstal">---</span>
        </div>

        <table>
            <thead><tr><th>Descripci√≥n</th><th class="text-center">Cant.</th><th class="text-right">P. Unit.</th><th class="text-right">Subtotal</th></tr></thead>
            <tbody id="tablaItems"></tbody>
        </table>

        <div class="summary-section">
            <div class="summary-row"><span>Subtotal Prod:</span><span id="subProd"></span></div>
            <div class="summary-row"><span>Env√≠o:</span><span id="subEnv"></span></div>
            <div class="summary-row"><span>Instalaci√≥n:</span><span id="subInst"></span></div>
            <div class="summary-row" style="color:#d9534f;"><span>Descuento:</span><span id="subDesc"></span></div>
            <div class="summary-row summary-total"><span>TOTAL:</span><span id="resTotal"></span></div>
        </div>

        <div class="terms">
            <strong>T√©rminos y Condiciones:</strong> La oferta es v√°lida por 15 d√≠as. El tiempo estimado de entrega es de 3 a 5 d√≠as h√°biles. Aceptamos pagos por Yape, Plin y Transferencia Bancaria. Una vez procesado el vidrio, no se aceptan devoluciones por cambio de medida.
        </div>
    </div>

    <button class="btn btn-blue" onclick="descargarImagen()">üì∏ Descargar Imagen (WhatsApp)</button>
    <button class="btn btn-green" onclick="window.print()">üñ®Ô∏è Guardar PDF (100% Offline)</button>
    <div class="footer-credits" style="color:#aaa;">¬© 2026 | Systems & Optimization by <b>Paul GC</b></div>
</div>

<script>
    // 1. CARGA INICIAL
    window.onload = () => {
        document.getElementById('configEmpresa').value = localStorage.getItem('d_nom') || "Dazoru Projects";
        document.getElementById('configCelulares').value = localStorage.getItem('d_tel') || "930 132 709 / 958 786 703";
        document.getElementById('configEmail').value = localStorage.getItem('d_em') || "dazoruprojects@gmail.com";
        
        const savedLogo = localStorage.getItem('d_logo');
        if(savedLogo) {
            document.getElementById('bolLogo').src = savedLogo;
            document.getElementById('bolLogo').style.display = 'block';
            document.getElementById('bolWatermark').style.backgroundImage = `url(${savedLogo})`;
        }
        updateOpacity(localStorage.getItem('d_op') || 0.1);
        calc();
    };

    function saveConf() {
        localStorage.setItem('d_nom', document.getElementById('configEmpresa').value);
        localStorage.setItem('d_tel', document.getElementById('configCelulares').value);
        localStorage.setItem('d_em', document.getElementById('configEmail').value);
    }

    function toggleConfig() { 
        const p = document.getElementById('configPanel'); 
        p.style.display = p.style.display === 'block' ? 'none' : 'block'; 
    }

    function handleLogo(e) {
        const reader = new FileReader();
        reader.onload = () => {
            const base = reader.result;
            localStorage.setItem('d_logo', base);
            document.getElementById('bolLogo').src = base;
            document.getElementById('bolLogo').style.display = 'block';
            document.getElementById('bolWatermark').style.backgroundImage = `url(${base})`;
        };
        reader.readAsDataURL(e.target.files[0]);
    }

    function updateOpacity(val) { 
        document.getElementById('bolWatermark').style.opacity = val; 
        document.getElementById('opacityRange').value = val;
        localStorage.setItem('d_op', val); 
    }

    // 2. L√ìGICA DE PRECIOS V13.3 (CONSERVADA)
    function calc() {
        const mat = document.getElementById('material').value;
        const formaEl = document.querySelector('input[name="forma"]:checked');
        const forma = formaEl ? formaEl.value : 'rect';
        
        const ancho = parseFloat(document.getElementById('ancho').value) || 0;
        let alto = (forma === 'circ') ? ancho : (parseFloat(document.getElementById('alto').value) || 0);
        const cant = parseFloat(document.getElementById('cantidad').value) || 1;
        
        document.getElementById('colAlto').style.display = (forma === 'circ') ? 'none' : 'block';
        document.getElementById('finishGroup').style.display = (mat === '3mm_marco') ? 'none' : 'block';

        if(ancho === 0 || alto === 0) { document.getElementById('totalDisp').innerText = "S/ 0.00"; return; }

        let precioUni = 0;

        // A) OFERTAS (3mm + Marco)
        if(mat === '3mm_marco' && ancho <= 50 && alto <= 50 && forma === 'rect') {
            const t = {30:25, 35:28, 40:30, 45:33, 50:35};
            precioUni = t[Math.max(ancho, alto)] || 35;
        } 
        // B) REFERENCIAS 50x50 (PRECIO PREMIUM FIJO)
        else if(ancho === 50 && alto === 50 && forma === 'rect') {
            let baseRef = 0;
            if(mat === '4mm') baseRef = 40; 
            else if(mat === 'opti') baseRef = 82;
            else if(mat === '3mm') baseRef = 35;
            
            if(baseRef > 0) {
                const acaEl = document.querySelector('input[name="acabado"]:checked');
                const aca = acaEl ? acaEl.value : 'pul';
                let extra = 0;
                if(aca === 'bis1') extra = 25; 
                else if(aca === 'bis2') extra = 45;
                precioUni = baseRef + extra;
            } else {
                precioUni = calcularDinamico(ancho, alto, forma, mat);
            }
        }
        // C) DIN√ÅMICO
        else {
            precioUni = calcularDinamico(ancho, alto, forma, mat);
        }

        // D) EXTRAS
        let areaReal = (forma === 'rect') ? (ancho*alto)/10000 : (Math.PI * Math.pow(ancho/2, 2)) / 10000;
        
        if(document.getElementById('arenado').value === 'si') precioUni += Math.max(55, areaReal * 140);
        
        const led = document.getElementById('led').value;
        if(led === '1') precioUni += 170;
        if(led === '3') precioUni += 240;

        if(document.getElementById('segCheck').checked) precioUni += (areaReal * 25);

        // TOTALES
        precioUni = Math.ceil(precioUni / 5) * 5;
        const subProd = precioUni * cant;
        const total = subProd + (parseFloat(document.getElementById('envio').value)||0) + (parseFloat(document.getElementById('instal').value)||0) - (parseFloat(document.getElementById('descuento').value)||0);

        document.getElementById('totalDisp').innerText = `S/ ${total.toFixed(2)}`;
        return { total, subProd, precioUni, cant, mat, ancho, alto };
    }

    function esPulido() {
        const op = document.querySelector('input[name="acabado"]:checked');
        return op && op.value === 'pul';
    }

    function calcularDinamico(w, h, forma, mat) {
        let area = (w * h) / 10000;
        let perim = (forma === 'rect') ? (w*2 + h*2)/100 : (Math.PI * w)/100;
        
        let precioM2 = 120;
        if(mat === '4mm') precioM2 = 160; 
        if(mat === 'opti') precioM2 = 300; 
        
        if(forma === 'circ') {
            area = (Math.PI * Math.pow(w/2, 2)) / 10000; 
        }
        let costoVidrio = area * precioM2;

        let costoBorde = 0;
        if(mat === '3mm_marco') {
            costoBorde = perim * 10; 
        } else {
            const acaEl = document.querySelector('input[name="acabado"]:checked');
            const aca = acaEl ? acaEl.value : 'pul';
            
            if(aca === 'pul') costoBorde = perim * 5;
            else if(aca === 'bis1') costoBorde = Math.max(25, perim * 12.50);
            else if(aca === 'bis2') costoBorde = Math.max(45, perim * 22.50);
        }

        return costoVidrio + costoBorde;
    }

    function generarBoleta() {
        const d = calc();
        if(!d) return alert("Ingresa medidas");

        document.getElementById('resEmpresa').innerText = document.getElementById('configEmpresa').value;
        document.getElementById('resTelf').innerText = document.getElementById('configCelulares').value;
        document.getElementById('resEmail').innerText = document.getElementById('configEmail').value;
        
        document.getElementById('resCliente').innerText = document.getElementById('cliente').value || "Cliente General";
        document.getElementById('resCel').innerText = document.getElementById('telCliente').value || "---";
        document.getElementById('resDir').innerText = document.getElementById('dirCliente').value || "---";
        document.getElementById('resFecha').innerText = new Date().toLocaleDateString('es-PE');
        
        const rand = Math.floor(100000 + Math.random() * 900000);
        document.getElementById('bolCodigo').innerText = `B001-${rand}`;

        const f = document.getElementById('fechaInstalManual').value;
        const hora = document.getElementById('horaInstalManual').value;
        const banner = document.getElementById('bannerInstal');
        if(f) {
            const dateObj = new Date(f + "T00:00:00");
            const options = { weekday: 'long', day: 'numeric', month: 'long' };
            document.getElementById('resFechaInstal').innerText = `${dateObj.toLocaleDateString('es-ES', options)}, ${hora || ''}`;
            banner.style.display = "flex";
        } else {
            banner.style.display = "none";
        }

        // DESCRIPCI√ìN
        let nombre = document.getElementById('material').options[document.getElementById('material').selectedIndex].text.toUpperCase();
        if(d.mat !== '3mm_marco') {
             const acaNom = document.querySelector('input[name="acabado"]:checked').nextElementSibling.innerText;
             nombre += ` (${acaNom})`;
        }
        const ledVal = document.getElementById('led').value;
        if(ledVal !== 'no') nombre += (ledVal==='1') ? ' + LED 1 Tono' : ' + LED 3 Tonos';
        
        nombre += ` [${document.getElementById('ancho').value}x${document.getElementById('alto').value}cm]`;

        document.getElementById('tablaItems').innerHTML = `
            <tr>
                <td>${nombre}</td>
                <td class="text-center">${d.cant}</td>
                <td class="text-right">S/ ${d.precioUni.toFixed(2)}</td>
                <td class="text-right">S/ ${d.subProd.toFixed(2)}</td>
            </tr>`;

        document.getElementById('subProd').innerText = `S/ ${d.subProd.toFixed(2)}`;
        document.getElementById('subEnv').innerText = `S/ ${parseFloat(document.getElementById('envio').value||0).toFixed(2)}`;
        document.getElementById('subInst').innerText = `S/ ${parseFloat(document.getElementById('instal').value||0).toFixed(2)}`;
        document.getElementById('subDesc').innerText = `- S/ ${parseFloat(document.getElementById('descuento').value||0).toFixed(2)}`;
        document.getElementById('resTotal').innerText = `S/ ${d.total.toFixed(2)}`;
        
        document.getElementById('calcView').classList.add('hidden');
        document.getElementById('boletaContainer').style.display = 'block';
    }

    function volver() {
        document.getElementById('calcView').classList.remove('hidden');
        document.getElementById('boletaContainer').style.display = 'none';
    }

    function descargarImagen() {
        if (!window.html2canvas) return alert("Necesitas internet para esta funci√≥n.");
        const bol = document.getElementById("boletaView");
        html2canvas(bol, { scale: 2 }).then(canvas => {
            const link = document.createElement("a");
            link.download = `Boleta_Dazoru_${Date.now()}.png`;
            link.href = canvas.toDataURL("image/png");
            link.click();
        });
    }
</script>
</body>
</html>
